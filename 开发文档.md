## 概述

本项目结构以该项目为例[AZCodingAccount/iGomokuGame: 一个在线五子棋游戏 (github.com)](https://github.com/AZCodingAccount/iGomokuGame)，前端项目文件夹`iSchool-Web`、后端项目文件夹`iSchool-Server`，开发者需补充一切认为必要的开发文档在**各自文件夹**下的README文件中。

- 项目总开发文档：[Albert Zhang](https://github.com/AZCodingAccount)
- 前端项目开发文档：[qwq007 ](https://github.com/qwq007)
- 后端项目开发文档：[Albert Zhang](https://github.com/AZCodingAccount)

## Git前缀规范

本项目常用的前缀有`feat`、`fix`、`docs`、`UI`

```
💥 feat(模块): 添加了个很棒的功能
🐛 fix(模块): 修复了一些 bug
📝 docs(模块): 更新了一下文档
🌷 UI(模块): 修改了一下样式
🏰 chore(模块): 对脚手架做了些更改
🌐 locale(模块): 为国际化做了微小的贡献
refactor, perf, workflow, build, CI, typos, tests, types, wip, release, dep
```

## Git workflow

项目开发在dev分支上、main分支设置了权限（仅管理者可以合并）。一般的工作流程

管理者初始化：

```bash
git init			# 初始化git仓库
git add .			# 添加文件到工作区
git branch -M main	# 切换master分支为main（政治正确）
git remote add origin https://github.com/AZCodingAccount/iSchool.git	# 关联远程仓库
git push -u origin main													# 推送，-u设置为默认仓库和分支
```

```bash
git branch dev		# 创建dev分支
git checkout dev	# 切换到dev分支工作
```

贡献者开发流程

```bash
git clone https://github.com/AZCodingAccount/iSchool.git	# 克隆项目到本地
git checkout dev		# 切换到dev分支
git add .				# 添加本地文件
git commit -m "{前缀}: {功能描述}"
git remote add origin https://github.com/AZCodingAccount/iSchool.git	# 关联远程仓库
git push -u origin dev													# 推送，-u设置为默认仓库和分支


# 本地开发，完成一个新功能进行下列工作流即可
git add .
git commit -m "{前缀}: {功能描述}"
git push
```

## 界面设计

### 用户模块

登录页面

<img src="https://my-picture-bed1-1321100201.cos.ap-beijing.myqcloud.com/mypictures/image-20240418215223487.png" alt="image-20240418215223487" style="zoom: 50%;" />

注册页面（忘记密码页面可以先不开发）

<img src="https://my-picture-bed1-1321100201.cos.ap-beijing.myqcloud.com/mypictures/image-20240418215324090.png" alt="image-20240418215324090" style="zoom:50%;" />

个人中心页面

<img src="https://my-picture-bed1-1321100201.cos.ap-beijing.myqcloud.com/mypictures/image-20240419220116345.png" alt="image-20240419220116345" style="zoom:50%;" />

消息提示：（点击**去查看**按钮，跳转到指定路由，后端返回数据会返回响应路径，直接router.push即可）

<img src="https://my-picture-bed1-1321100201.cos.ap-beijing.myqcloud.com/mypictures/image-20240501211549906.png" alt="image-20240501211549906" style="zoom:50%;" />



### 搜索模块

首页：

<img src="https://my-picture-bed1-1321100201.cos.ap-beijing.myqcloud.com/mypictures/image-20240501213527954.png" alt="image-20240501213527954" style="zoom:50%;" />

搜索成功的页面（ps：前端需要寻找vue中的markdown解析器解析AI智达内容，因为AI返回的内容是md格式）

<img src="https://my-picture-bed1-1321100201.cos.ap-beijing.myqcloud.com/mypictures/image-20240502161250927.png" alt="image-20240502161250927" style="zoom:50%;" />

- **进一步聊聊，AI聊天**参考这个githubUI项目：[Windows 12 网页版 (tjy-gitnub.github.io)](https://tjy-gitnub.github.io/win12/desktop.html)   可以看看我提的pr，就是关于这个机器人聊天的[PR](https://github.com/tjy-gitnub/win12/pull/415)

- 站外搜索先不用实现了
- 大众点评跳到大众点评那个页面就可以了

### 大众点评模块

主页（点击五角星就可以评分，评分后锁定，有评分这个组件）

<img src="https://my-picture-bed1-1321100201.cos.ap-beijing.myqcloud.com/mypictures/image-20240503173238825.png" alt="image-20240503173238825" style="zoom:50%;" />

评论页面（评论参考[CodeTop 面试题目总结](https://codetop.cc/home)，这个网站的评论功能，就是右边一个抽屉）

<img src="https://my-picture-bed1-1321100201.cos.ap-beijing.myqcloud.com/mypictures/image-20240503174702034.png" alt="image-20240503174702034" style="zoom:50%;" />

添加点评对象页面

<img src="https://my-picture-bed1-1321100201.cos.ap-beijing.myqcloud.com/mypictures/image-20240503210325163.png" alt="image-20240503210325163" style="zoom: 50%;" />

## 流程叙述

### 大众点评模块流程叙述

一共9个接口

点评对象（comment_obj）

1. 用户点击大众点评tab栏，程序发送查询请求，keyword为"",type为""，拿到全部数据渲染
2. 用户点击搜索按钮，拿到搜索词作为keyword，下拉框内容作为type，发送查询请求拿到部分数据渲染
3. 用户点击星星，进行评分，发送评分请求。已评分过的内容不可评分（**后续扩展，暂不需实现**）
4. 用户点击去添加按钮，弹出模态框，输入名称，选择类型，发送添加点评对象请求

一级评论（comments）

1. 用户点击更多，查询所有一级评论，渲染
2. 用户给一级评论点赞，发送点赞请求
3. 用户回复一级评论，发送添加一级评论请求

二级评论(reply_comments)

1. 用户点击查看回复，查询所有二级评论，渲染
2. 用户给二级评论点赞，发送点赞请求
3. 用户回复二级评论，发送添加二级评论请求

ps：参考接口文档和数据库表注释，注意每次请求的发送参数和返回参数就可以了

（还有一个用户点完赞不能点赞了，这个后续还需要兼容一下）

### 主页流程概述

一共四个接口

​		用户输入关键词，发送两个请求，一个分页查询获取搜索数据，一个请求（aiSearch）通知后端去生成AI答案。当用户点击**查看AI建议**时，向后端发送请求（aiSearchRes），再获取AI的答案（注意，如果AI答案尚未生成完成，服务端返回生成中信息，code不为1）。

​		点击聊天，将用户搜索关键词和AI答案渲染到页面上，之后，调用chat接口问答即可。

### 个人中心消息概述

- 点击查看消息，发送请求（getMessageList），获取所有未读消息，渲染。

- 当用户点击去查看时，只需传过去objId，打开对应点评对象的评论即可（直接跳转到当前评论位置实现起来可能困难）



## 技术实现细节

​		对于数据库的同步，我采用的是一天增量同步一次，具体是第一次首先进行一个全量的同步，后续我传入文章id，爬取到比这个文章id小的元素，我就停止，然后写入数据库即可。（需要注意的是，article不一定连续，但递增，可能有发布然后删除的情况出现）

​		考虑到可能会删除，但是是极少数情况，一周全量同步一次即可

第一次同步，同步了2755条，一共花费了1658s，大概28分钟

MySQL全文索引用法

```SQL

ALTER TABLE info DROP INDEX title;	# 添加索引

ALTER TABLE info ADD FULLTEXT(title, content);	# 删除索引
# my.ini调整关联词长度（可以去注册表找配置文件位置：https://blog.csdn.net/gpweixing/article/details/111108109）
innodb_ft_min_token_size = 1
ft_min_word_len = 1	

# 查询是否修改成功（一定要先重启MySQL服务）
show variables like 'innodb_ft_min_token_size';

show variables like 'ft_min_word_len';

# 数据量5416条
select *
from info
where content like '%保研%'
  and school = 'HRBUST';	


select *
from info
where MATCH(title, content) AGAINST('保研')
  and school = 'HRBUST';	# 使用全文索引搜索
```

## 扩展补充

错误日志、成功日志记录表、user表添加school字段、新增school表

- 集成Skywalking
- 集成限流算法，根据压测接口

分布式任务调度

- 全量同步每天凌晨0点0分0秒
- 增量6-24点每5分钟一次

调用失败由python程序往数据库写日志，并返回给Java程序error msg，Java程序收到后邮件告警，人工看日志进行处理

>不设置失败重试，因为一般同步失败就是代码或者页面结构出问题了，且要保证幂等性（第二次同步删除之前同步的数据，如果实现的话可以采用文章id，大于当前同步的文章id删除即可），如果同步失败人工处理即可

**后续：已拓展幂等性，设置失败重试次数为3**
